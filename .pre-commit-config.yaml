# .pre-commit-config.yaml
#
# What this does
# --------------
# Runs automated checks/formatters:
# - whitespace / EOF hygiene
# - YAML syntax validation (MkDocs config often needs --unsafe)
# - Markdown formatting (MkDocs-friendly; keeps admonition indentation sane)
# - Python lint (with safe auto-fixes) + Python formatting (Ruff)
#
# Typical workflow
# ----------------
# First run may "fail" because some hooks MODIFY files (by design):
#   pre-commit run --all-files
#   git add -A
#   pre-commit run --all-files
# Running hooks on all files is an official pre-commit usage pattern.
#
# Path note (Windows)
# -------------------
# pre-commit matches file paths using git-style forward slashes (/), even on Windows.

# REPO-WIDE EXCLUSIONS (APPLIES TO *ALL* HOOKS)
# --------------------------------------------
# pre-commit's `exclude` takes a SINGLE regular expression string.
# The top-level `exclude` is applied to all hooks.
#
# Excluded FOLDERS:
# - ontologies/                            (and all its sub-folders, including ontologies/versioned/)
# - vocabulary/                            (and all its sub-folders)
# - docs/deliverables/                     (generated exports)
# Excluded FILES:
# - LICENSE-*.md                           (license variants)
# - *.tsv                                  (tabular exports)
# - docs/method/specification-vocabulary.html (generated HTML)
exclude: ^(ontologies/|vocabulary/|docs/deliverables/|LICENSE-.*\.md$|.*\.tsv$|docs/method/specification-vocabulary\.html$)

repos:
  # ---------------------------------------------------------------------------
  # 1) Universal hygiene checks (fast and low-risk)
  # ---------------------------------------------------------------------------
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v6.0.0
    hooks:
      # Removes trailing whitespace at end of lines.
      - id: trailing-whitespace

      # Ensures files end with a newline.
      - id: end-of-file-fixer

      # YAML validation.
      # --unsafe: parse syntax without "loading" YAML, enabling extensions/unsafe constructs
      # (useful for MkDocs configs with python tags / custom constructors).
      - id: check-yaml
        args: [--unsafe]

  # ---------------------------------------------------------------------------
  # 2) Markdown formatting (MkDocs-friendly)
  # ---------------------------------------------------------------------------
  - repo: https://github.com/hukkin/mdformat
    rev: 1.0.0
    hooks:
      - id: mdformat
        # Only run on Markdown files.
        files: \.(md|mdx)$
        # Plugins installed inside the hook venv:
        # - mdformat-mkdocs: MkDocs/MkDocs-Material friendly formatting; keeps 4-space indents.
        args: [--number]
        additional_dependencies:
          - mdformat-gfm
          - mdformat-frontmatter
          - mdformat-mkdocs==5.1.4
          - mdformat-footnote==0.1.3

  # ---------------------------------------------------------------------------
  # 3) Python lint + format (Ruff)
  # ---------------------------------------------------------------------------
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.15.1
    hooks:
      # Lint first (and auto-fix where safe), then format.
      # Ruff recommends placing the lint hook before the formatter when using --fix.
      - id: ruff-check
        args: [--fix]
        types_or: [python, pyi]

      - id: ruff-format
        types_or: [python, pyi]
