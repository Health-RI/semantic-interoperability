# .pre-commit-config.yaml
#
# What this does
# --------------
# Runs automated checks/formatters:
# - whitespace / EOF hygiene
# - YAML syntax validation (MkDocs config often needs --unsafe)
# - Markdown formatting (MkDocs-friendly; keeps admonition indentation sane)
# - Python lint (with safe auto-fixes) + Python formatting (Ruff)
#
# Typical workflow
# ----------------
# First run may "fail" because some hooks MODIFY files (by design):
#   pre-commit run --all-files
#   git add -A
#   pre-commit run --all-files
# Running hooks on all files is an official pre-commit usage pattern. :contentReference[oaicite:2]{index=2}
#
# Path note (Windows)
# -------------------
# pre-commit matches file paths using git-style forward slashes (/), even on Windows.

# REPO-WIDE EXCLUSIONS (APPLIES TO *ALL* HOOKS)
# --------------------------------------------
# pre-commit's `exclude` takes a SINGLE regular expression string. :contentReference[oaicite:3]{index=3}
# The top-level `exclude` is applied to all hooks. :contentReference[oaicite:4]{index=4}
#
# Excluded folders:
# - ontologies/                            (and all its sub-folders)
# - ontologies/versioned/                  (and all its sub-folders)
# - docs/deliverables/                     (generated exports)
exclude: ^(ontologies/|vocabulary/|docs/deliverables/LICENSE-*.md)

repos:
  # ---------------------------------------------------------------------------
  # 1) Universal hygiene checks (fast and low-risk)
  # ---------------------------------------------------------------------------
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v6.0.0
    hooks:
      # Removes trailing whitespace at end of lines.
      - id: trailing-whitespace

      # Ensures files end with a newline.
      - id: end-of-file-fixer

      # YAML validation.
      # --unsafe: parse syntax without "loading" YAML, enabling extensions/unsafe constructs
      # (useful for MkDocs configs with python tags / custom constructors). :contentReference[oaicite:5]{index=5}
      - id: check-yaml
        args: [--unsafe]

  # ---------------------------------------------------------------------------
  # 2) Markdown formatting (MkDocs-friendly)
  # ---------------------------------------------------------------------------
  - repo: https://github.com/hukkin/mdformat
    rev: 1.0.0
    hooks:
      - id: mdformat
        # Only run on Markdown files.
        files: \.(md|mdx)$
        # Plugins installed inside the hook venv:
        # - mdformat-mkdocs: MkDocs/MkDocs-Material friendly formatting; keeps 4-space indents. :contentReference[oaicite:6]{index=6}
        additional_dependencies:
          - mdformat-gfm
          - mdformat-frontmatter
          - mdformat-mkdocs==5.1.4

  # ---------------------------------------------------------------------------
  # 3) Python lint + format (Ruff)
  # ---------------------------------------------------------------------------
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.15.1
    hooks:
      # Lint first (and auto-fix where safe), then format.
      # Ruff recommends placing the lint hook before the formatter when using --fix. :contentReference[oaicite:7]{index=7}
      - id: ruff-check
        args: [--fix]
        types_or: [python, pyi]

      - id: ruff-format
        types_or: [python, pyi]
